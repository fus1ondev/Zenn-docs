---
title: "ã€SwiftUIã€‘TextField+DatePickerã§èµ·ã“ã‚‹ãƒã‚°ã®å¯¾å‡¦æ³•"
emoji: "ğŸ•°ï¸"
type: "tech"
topics:
  - "ios"
  - "swift"
  - "swiftui"
published: true
published_at: "2022-05-04 09:56"
---

## ã¯ã˜ã‚ã«

https://medium.com/@Yerazhas/custom-date-picker-textfield-in-swiftui-8505f8974f5b

ã“ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦DatePickerãŒè¡¨ç¤ºã•ã‚Œã‚‹TextFieldã‚’ç”¨æ„ã—ã€ãƒ¢ãƒ¼ãƒ‰ã‚’ `.countdowntimer`ï¼ˆåˆ†ãƒ»ç§’é¸æŠï¼‰ã«å¤‰æ›´ã—ãŸã¨ã“ã‚ã€1å›ç›®ã«é¸æŠã—ãŸå€¤ãŒåå¿œã—ãªã„ã¨ã„ã†ãƒã‚°ãŒèµ·ã“ã‚Šã¾ã—ãŸã€‚

```Swift
datePicker.datePickerMode = .countDownTimer
```

ä¸€åº¦æ™‚åˆ»ã‚’é¸æŠã—ã¦ã‚‚`.valueChanged`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã›ãšã€ï¼’å›ç›®ä»¥é™ã«é¸æŠã™ã‚‹ã¨æ­£å¸¸ã«å‹•ãã¾ã™ã€‚

## å¯¾å‡¦æ³•

https://appleharikyu.jp/iphone/?p=1246

èª¿ã¹ã¦ã„ã‚‹ã†ã¡ã«ãŸã©ã‚Šç€ã„ãŸã“ã®è¨˜äº‹ã«ã‚ˆã‚‹ã¨ã€ã©ã†ã‚„ã‚‰iOS7æ™‚ä»£ã‹ã‚‰å­˜åœ¨ã™ã‚‹å¤ã®ãƒã‚°ã ã£ãŸã‚ˆã†ã§ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆæœŸå€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨ç›´ã‚‹ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚

UITextFieldã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹DatePickerTextFieldã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚¶å†…ã§ã‚ªãƒ–ã‚¶ãƒ¼ãƒãƒ¼ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

```Swift
NotificationCenter.default.addObserver(
    self,
    selector: #selector(self.keyboardDidShow(notification:)),
    name: UIResponder.keyboardDidShowNotification,
    object: nil
)
```

ãã—ã¦ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ™‚ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ï¼ˆåˆæœŸå€¤ã®ã‚»ãƒƒãƒˆï¼‰ã‚’ç”¨æ„ã—ã¾ã™ã€‚

`.countdowntimer`ãƒ¢ãƒ¼ãƒ‰ã§ã¯`date`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½¿ç”¨ã•ã‚Œãªã„ã®ã§ã€`countDownDuration`ã«ç§’æ•°ã‚’ã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```Swift
@objc func keyboardDidShow(notification: Notification) {
    DispatchQueue.main.async {
        self.datePicker.countDownDuration = TimeInterval(second)
    }
}
```

`second`ã«ã¯Doubleå‹ã§ç§’æ•°ã‚’å…¥ã‚Œã¦ã‚ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼ˆé©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ï¼‰ã€‚

## ãŠã‚ã‚Šã«

å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

`.countDownTimer`ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ã€ä½•ç®‡æ‰€ã‹å¤‰æ›´ã‚’åŠ ãˆã¦ã„ã¾ã™ã€‚

```Swift
//ref: https://medium.com/@Yerazhas/custom-date-picker-textfield-in-swiftui-8505f8974f5b

import SwiftUI

struct DatePickerInputView: UIViewRepresentable {
    @Binding var minute: Int
    let placeholder: String
    
    init(minute: Binding<Int>, placeholder: String) {
        self._minute = minute
        self.placeholder = placeholder
    }
    
    func updateUIView(_ uiView: DatePickerTextField, context: Context) {
        setText(uiView)
    }
    
    func makeUIView(context: Context) -> DatePickerTextField {
        let datePickerTextField = DatePickerTextField(minute: $minute, frame: .zero)
        datePickerTextField.placeholder = placeholder
        setText(datePickerTextField)
        return datePickerTextField
    }
    
    private func setText(_ datePickerTextField: DatePickerTextField) {
        datePickerTextField.text = "\(minute / 60)hours \(minute % 60)min"
    }
}

final class DatePickerTextField: UITextField {
    @Binding var minute: Int
    private let datePicker = UIDatePicker()
    
    init(minute: Binding<Int>, frame: CGRect) {
        self._minute = minute
        super.init(frame: frame)
        inputView = datePicker
        datePicker.addTarget(self, action: #selector(datePickerDidSelect(_:)), for: .valueChanged)
        datePicker.datePickerMode = .countDownTimer
        NotificationCenter.default.addObserver(
            self,
            selector: #selector(self.keyboardDidShow(notification:)),
            name: UIResponder.keyboardDidShowNotification,
            object: nil
        )
        let toolBar = UIToolbar()
        toolBar.sizeToFit()
        let flexibleSpace = UIBarButtonItem(barButtonSystemItem: .flexibleSpace, target: nil, action: nil)
        let doneButton = UIBarButtonItem(title: "Done", style: .plain, target: self, action: #selector(dismissTextField))
        toolBar.setItems([flexibleSpace, doneButton], animated: false)
        inputAccessoryView = toolBar
    }
    
    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    @objc private func datePickerDidSelect(_ sender: UIDatePicker) {
        self.minute = Int(datePicker.countDownDuration / 60)
    }
    
    @objc func keyboardDidShow(notification: Notification) {
        let secondDouble = Double(minute * 60)
        DispatchQueue.main.async {
            self.datePicker.countDownDuration = TimeInterval(self.secondDouble)
        }
    }
    
    @objc private func dismissTextField() {
        resignFirstResponder()
    }
    
    override func caretRect(for position: UITextPosition) -> CGRect {
        return CGRect.zero
    }
    
    override func selectionRects(for range: UITextRange) -> [UITextSelectionRect] {
        return []
    }

    override func canPerformAction(_ action: Selector, withSender sender: Any?) -> Bool {
        return false
    }
}
```