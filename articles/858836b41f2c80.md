---
title: "ã€GitHub Actionsã€‘PRãŒæ¥ãŸã‚‰è‡ªå‹•ã§JSONã‚¹ã‚­ãƒ¼ãƒã‚’æ¤œè¨¼ã™ã‚‹"
emoji: "ğŸ”"
type: "tech"
topics:
  - "nodejs"
  - "githubactions"
  - "json"
  - "ajv"
published: true
published_at: "2022-07-22 13:40"
---

JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãŸã‚ã«ã€Pull RequestãŒæ¥ãŸã‚‰ãã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ãŒã‚ã‚‰ã‹ã˜ã‚è¦å®šã—ãŸã‚¹ã‚­ãƒ¼ãƒã«ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹æ¤œè¨¼ï¼ˆvalidateï¼‰ã™ã‚‹ä»•çµ„ã¿ã‚’ç”¨æ„ã—ã¦ã¿ã¾ã™ã€‚

## JSONã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆã™ã‚‹

1ã‹ã‚‰æ‰‹æ›¸ãã™ã‚‹ã¨å¤§å¤‰ãªã®ã§ã€ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã«é ¼ã£ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã¯[quicktype](https://app.quicktype.io/)ã¨ã„ã†ã‚µã‚¤ãƒˆã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/30dca5916229-20220722.png)

å·¦å´ã®é»’ã„ç”»é¢ã«æ‰‹å…ƒã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨ã€ãã‚Œã‚’å…ƒã«ã„ã„æ„Ÿã˜ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚

å³ä¸Šã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§`JSON Schema`ã‚’é¸ã¶å¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ä½œæˆã—ãŸã‚¹ã‚­ãƒ¼ãƒã¯`schema.json`ã¨ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ã„ã¦ãŠãã¾ã™ã€‚

## Ajvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚¹ã‚­ãƒ¼ãƒã‚’æ¤œè¨¼ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹Ajvã®CLIç‰ˆã€`ajv-cli`ã‚’ä½¿ã„ã¾ã™ã€‚

https://github.com/ajv-validator/ajv-cli

```shell
npm install ajv-cli
```

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

`package.json`ã«`validate`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚

```json:package.json
"scripts": {
    "validate": "npx ajv validate -s schema.json -d target.json"
}
```

## ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ

è©¦ã—ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```shell
npm run validate
```

JSONã‚¹ã‚­ãƒ¼ãƒã«ä¸€è‡´ã—ã¦ã„ãªã„å ´åˆã¯ã€ã“ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚
ã“ã®å ´åˆã¯æœ¬æ¥å¿…è¦ãªã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã¾ã™ã€‚

```
target.json invalid
[
  {
    instancePath: '/0/items/0',
    schemaPath: '#/definitions/Item/required',
    keyword: 'required',
    params: { missingProperty: 'name' },
    message: "must have required property 'name'"
  }
]
```

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹

ã¾ãš`.github/workflow/validate.yml`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã«ç·¨é›†ã—ã¾ã™ã€‚

`main`ãƒ–ãƒ©ãƒ³ãƒã«Pull RequestãŒæ¥ãŸæ™‚ã«ãƒˆãƒªã‚¬ãƒ¼ãŒèµ·å‹•ã—ã€Ubuntuä¸Šã§Node.jsã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€`npm ci`ã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Ajvã‚’å®Ÿè¡Œã™ã‚‹ã¨ã„ã†æµã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚

```yml
name: JSON Validate

on:
  pull_request:
    branches: [ "main" ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: JSON Validate
      uses: actions/setup-node@v3
      with:
        node-version: 16.x
        cache: 'npm'
    - run: npm ci
    - run: npm run validate
```

ã“ã‚Œã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨ã€å•é¡Œãªãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e56101919df8-20220722.png)

ä»¥ä¸Šã§å®Œæˆã§ã™ã€‚

`target.json`ã«å¤‰æ›´ã‚’åŠ ãˆã¦PRã‚’å‡ºã™ã¨ã€è‡ªå‹•ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### å‚è€ƒæ–‡çŒ®

https://hossainkhan.medium.com/use-node-js-tools-on-github-actions-ci-workflow-120fb3b4a3e1